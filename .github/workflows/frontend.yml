name: Deploy React Frontend Applications

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: self-hosted
    steps:
      - name: Checkout Source
        uses: actions/checkout@v4

      - name: Login to Docker Hub
        run: sudo docker login -u ${{ secrets.DOCKER_USERNAME }} -p ${{ secrets.DOCKER_PASSWORD }}

      # Food Web Frontend
      - name: Build Food Web Frontend
        run: |
          bash -c 'sudo docker build --no-cache -f "Frontend/Food Website/Food Website/user/Dockerfile" \
          --build-arg VITE_API_URL=${{ secrets.VITE_API_URL }} \
          --build-arg VITE_CLOUDINARY_API=${{ secrets.VITE_CLOUDINARY_API }} \
          --build-arg VITE_RAZORPAY_KEY=${{ secrets.VITE_RAZORPAY_KEY }} \
          --build-arg VITE_FACEBOOK_1=${{ secrets.VITE_FACEBOOK_1 }} \
          --build-arg VITE_FACEBOOK_2=${{ secrets.VITE_FACEBOOK_2 }} \
          --build-arg VITE_LINKEDIN_1=${{ secrets.VITE_LINKEDIN_1 }} \
          --build-arg VITE_LINKEDIN_2=${{ secrets.VITE_LINKEDIN_2 }} \
          -t debdeep12/foodweb-frontend:latest "Frontend/Food Website/Food Website/user"'

      - name: Push Food Web Frontend
        run: sudo docker push debdeep12/foodweb-frontend:latest

      # Delivery Boy Frontend
      - name: Build Delivery Boy Frontend
        run: |
          bash -c 'sudo docker build --no-cache -f "Frontend/Delivary Boy/Delivary Boy/delivaryboy/Dockerfile" \
          --build-arg VITE_API_URL=${{ secrets.VITE_API_URL }} \
          -t debdeep12/deliveryboy-frontend:latest "Frontend/Delivary Boy/Delivary Boy/delivaryboy"'

      - name: Push Delivery Boy Frontend
        run: sudo docker push debdeep12/deliveryboy-frontend:latest

      # Admin Frontend
      - name: Build Admin Frontend
        run: |
          bash -c 'sudo docker build --no-cache -f "Frontend/Admin_Food Frontend Website/Admin_Food Frontend Website/frontend/Dockerfile" \
          --build-arg VITE_API_URL=${{ secrets.VITE_API_URL }} \
          -t debdeep12/admin-frontend:latest "Frontend/Admin_Food Frontend Website/Admin_Food Frontend Website/frontend"'

      - name: Push Admin Frontend
        run: sudo docker push debdeep12/admin-frontend:latest

      # Food Owner Frontend
      - name: Build Food Owner Frontend
        run: |
          bash -c 'sudo docker build --no-cache -f "Frontend/FoodOwner/FoodOwner/foodowner/Dockerfile" \
          --build-arg VITE_API_URL=${{ secrets.VITE_API_URL }} \
          --build-arg VITE_CLOUDINARY_API=${{ secrets.VITE_CLOUDINARY_API }} \
          -t debdeep12/foodowner-frontend:latest "Frontend/FoodOwner/FoodOwner/foodowner"'

      - name: Push Food Owner Frontend
        run: sudo docker push debdeep12/foodowner-frontend:latest

  deploy:
    needs: build
    runs-on: self-hosted
    steps:
      - name: Deploy Food Web
        run: |
          sudo docker rm -f foodweb-container || true
          sudo docker run -d --name foodweb-container -p 8080:80 debdeep12/foodweb-frontend:latest

      - name: Deploy Delivery Boy
        run: |
          sudo docker rm -f deliveryboy-container || true
          sudo docker run -d --name deliveryboy-container -p 3000:80 debdeep12/deliveryboy-frontend:latest

      - name: Deploy Admin
        run: |
          sudo docker rm -f admin-container || true
          sudo docker run -d --name admin-container -p 9000:80 debdeep12/admin-frontend:latest

      - name: Deploy Food Owner
        run: |
          sudo docker rm -f foodowner-container || true
          sudo docker run -d --name foodowner-container -p 4000:80 debdeep12/foodowner-frontend:latest
